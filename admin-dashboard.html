<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Toolspay — Admin Dashboard</title>
  <link rel="stylesheet" href="style.css"/>

  <style>
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;margin:14px 0}
    .row{display:grid;gap:12px}
    @media(min-width:780px){.row-2{grid-template-columns:1fr 1fr}.row-3{grid-template-columns:1fr 1fr 1fr}.row-4{grid-template-columns:1fr 1fr 1fr 1fr}}
    label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
    input,select,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn-primary{background:#0b1220;color:#ffd700;border:2px solid #ffd700}
    .btn-ghost{background:#f4f4f4}
    .muted{color:#6b7280;font-size:12px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .hidden{display:none}
    .list{border:1px dashed #ddd;border-radius:10px;padding:10px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left}
    .pill{padding:4px 10px;border:1px solid #ddd;border-radius:999px;font-size:12px}
  </style>
</head>
<body>
  <header style="padding:16px;border-bottom:1px solid #eee;background:#0b1220;">
    <div class="container header" style="color:#fff;">
      <div class="flex">
        <div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#111,#ffd700);display:flex;align-items:center;justify-content:center;font-weight:800;">TP</div>
        <div>
          <div style="font-weight:800;">Toolspay — Admin</div>
          <div class="muted" style="color:#cbd5e1;">Manage rates, wallets, cards, and announcements</div>
        </div>
      </div>
      <div class="flex">
        <button id="logoutBtn" class="btn-ghost">Sign out</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- AUTH -->
    <div id="authBlock" class="card">
      <h2>Admin sign in</h2>
      <p class="muted">Only emails in <code>admins</code> can access.</p>
      <div class="row row-2" style="margin-top:10px;">
        <div><label>Email</label><input id="email" type="email" placeholder="you@example.com"/></div>
        <div><label>Password</label><input id="password" type="password" placeholder="••••••••"/></div>
      </div>
      <div class="flex" style="margin-top:10px;">
        <button id="loginBtn" class="btn-primary">Sign in</button>
        <button id="resetBtn" class="btn-ghost">Send reset link</button>
      </div>
      <div id="authMsg" class="muted" style="margin-top:8px;"></div>
    </div>

    <!-- NOT ADMIN -->
    <div id="notAdmin" class="card hidden">
      <h3 style="color:#b91c1c">Not authorized</h3>
      <p class="muted">This account is not in <code>admins</code>. Use your <a href="grant-admin.html">Grant Admin</a> page once, then reload.</p>
    </div>

    <!-- ADMIN PANEL -->
    <section id="adminPanel" class="hidden">

      <!-- Rates -->
      <div class="card">
        <div class="header">
          <h2>Rates</h2>
          <span class="muted">Firestore: <code>rates/default</code></span>
        </div>
        <div class="row row-2" style="margin-top:10px;">
          <div>
            <label>USD → NGN</label>
            <input id="usdToNgn" type="number" placeholder="1500"/>
            <div class="muted">Shown to customers.</div>
          </div>
          <div>
            <label>Gift card base (₦ per $1)</label>
            <input id="giftcardBase" type="number" placeholder="1450"/>
            <div class="muted">Default fallback.</div>
          </div>
        </div>
        <div style="margin-top:10px;">
          <button id="saveRates" class="btn-primary">Save rates</button>
          <span id="ratesMsg" class="muted"></span>
        </div>
      </div>

      <!-- Wallets -->
      <div class="card">
        <div class="header">
          <h2>Wallets (BTC, USDT, Online Wallet rates)</h2>
          <span class="muted">Firestore: <code>wallets/default</code></span>
        </div>

        <div class="row row-2" style="margin-top:10px;">
          <div>
            <label>BTC Address</label>
            <input id="btcAddress" placeholder="bc1... or 1..."/>
          </div>
          <div>
            <label>Online Wallet Tags (optional quick-paste)</label>
            <div class="row">
              <input id="tagChime" placeholder="Chime tag"/>
              <input id="tagZelle" placeholder="Zelle tag/email"/>
              <input id="tagVenmo" placeholder="@venmo"/>
              <input id="tagPaypal" placeholder="PayPal email"/>
            </div>
            <div class="muted">Customers will chat you for the tag. These help you answer fast.</div>
          </div>
        </div>

        <div class="card" style="background:#fafafa;">
          <h3>USDT Networks</h3>
          <div id="networksList" class="list" style="margin-top:8px;"></div>
          <div class="row row-3" style="margin-top:8px;">
            <div><input id="newNetName" placeholder="TRC20 / ERC20 / BEP20"/></div>
            <div><input id="newNetAddr" placeholder="USDT address for this network"/></div>
            <div><button id="addNetwork" class="btn-ghost">Add network</button></div>
          </div>
        </div>

        <div class="card" style="background:#fafafa;">
          <h3>Online Wallets & Rates (you pay NGN)</h3>
          <div class="muted">Each row = one wallet (e.g., Chime, PayPal…). Rate = ₦ per 1 unit of the selected currency.</div>
          <div id="owList" class="list" style="margin-top:8px;"></div>
          <div class="row row-4" style="margin-top:8px;">
            <div><input id="owName" placeholder="Wallet name (Chime)"/></div>
            <div>
              <select id="owCurrency">
                <option value="USD">USD</option>
                <option value="GBP">GBP</option>
                <option value="EUR">EUR</option>
                <option value="AUD">AUD</option>
              </select>
            </div>
            <div><input id="owRate" type="number" placeholder="₦ per 1 unit"/></div>
            <div><button id="addOW" class="btn-ghost">Add / Update</button></div>
          </div>
        </div>

        <div style="margin-top:10px;">
          <button id="saveWallets" class="btn-primary">Save wallets</button>
          <span id="walletsMsg" class="muted"></span>
        </div>
      </div>

      <!-- Giftcards Catalog -->
      <div class="card">
        <div class="header">
          <h2>Gift Cards Catalog (brand + per-country rates)</h2>
          <span class="muted">Firestore: <code>giftcards/{brandId}</code></span>
        </div>

        <div class="row row-3" style="margin-top:10px;">
          <div><input id="gcId" placeholder="ID (amazon, itunes, steam...)"/></div>
          <div><input id="gcName" placeholder="Display name (Amazon)" /></div>
          <div><input id="gcLogo" type="file" accept="image/*"/></div>
        </div>

        <div class="card" style="background:#fafafa;margin-top:12px;">
          <h3>Countries & Rates for this brand</h3>
          <div class="muted">Rate = ₦ per $1 (or per face value unit for that country).</div>
          <div id="gcCountries" class="list" style="margin-top:8px;"></div>
          <div class="row row-4" style="margin-top:8px;">
            <div>
              <select id="newCtry">
                <option value="US">United States (US)</option>
                <option value="UK">United Kingdom (UK)</option>
                <option value="EU">Eurozone (EU)</option>
                <option value="CA">Canada (CA)</option>
                <option value="AU">Australia (AU)</option>
                <option value="CH">Switzerland (CH)</option>
                <option value="NG">Nigeria (NG)</option>
              </select>
            </div>
            <div><input id="newRate" type="number" placeholder="₦/unit"/></div>
            <div><input id="newMin" type="number" placeholder="Min face value"/></div>
            <div><button id="addCtry" class="btn-ghost">Add/Update Country</button></div>
          </div>
        </div>

        <div class="flex" style="margin-top:10px;">
          <button id="saveGiftcard" class="btn-primary">Save brand</button>
          <button id="loadGiftcard" class="btn-ghost">Load brand</button>
          <button id="deleteGiftcard" class="btn-ghost" style="background:#fee2e2;">Delete brand</button>
          <span id="gcMsg" class="muted"></span>
        </div>

        <div class="muted" style="margin-top:8px;">
          Preloaded suggestions: amazon, itunes, steam, googleplay, razergold, walmart, visa, amex, xbox.
        </div>
      </div>

      <!-- Announcements -->
      <div class="card">
        <div class="header">
          <h2>Announcements</h2>
          <span class="muted">Firestore: <code>announcements/default</code></span>
        </div>
        <div style="margin-top:10px;">
          <label>One per line</label>
          <textarea id="annTextarea" rows="5" placeholder="Welcome to Toolspay&#10;Trade only inside this site"></textarea>
        </div>
        <div style="margin-top:10px;">
          <button id="saveAnn" class="btn-primary">Save announcements</button>
          <span id="annMsg" class="muted"></span>
        </div>
      </div>

      <!-- (Optional) Upload proof to an order -->
      <div class="card">
        <div class="header">
          <h2>Upload proof to a Trade (optional)</h2>
          <span class="muted">Attach screenshot to <code>requests/{requestId}</code></span>
        </div>
        <div class="row row-3" style="margin-top:10px;">
          <div><input id="proofReqId" placeholder="requestId"/></div>
          <div><input id="proofFile" type="file" accept="image/*"/></div>
          <div><button id="uploadProof" class="btn-ghost">Upload</button></div>
        </div>
        <div id="proofMsg" class="muted" style="margin-top:8px;"></div>
      </div>

    </section>
  </main>

  <script type="module">
    import {
      auth, db, storage,
      signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged,
      saveGiftcard, getGiftcard, listGiftcards, uploadChatImage,
      // raw SDK helpers exported from firebase-auth.js
      doc, getDoc, setDoc, updateDoc, deleteDoc
    } from './firebase-auth.js';
    import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

    // UI refs
    const authBlock  = document.getElementById('authBlock');
    const adminPanel = document.getElementById('adminPanel');
    const notAdmin   = document.getElementById('notAdmin');

    const emailEl = document.getElementById('email');
    const passEl  = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const resetBtn = document.getElementById('resetBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const authMsg = document.getElementById('authMsg');

    // Rates
    const usdToNgn = document.getElementById('usdToNgn');
    const giftcardBase = document.getElementById('giftcardBase');
    const saveRates = document.getElementById('saveRates');
    const ratesMsg = document.getElementById('ratesMsg');

    // Wallets
    const btcAddress = document.getElementById('btcAddress');
    const tagChime = document.getElementById('tagChime');
    const tagZelle = document.getElementById('tagZelle');
    const tagVenmo = document.getElementById('tagVenmo');
    const tagPaypal = document.getElementById('tagPaypal');

    const networksList = document.getElementById('networksList');
    const newNetName = document.getElementById('newNetName');
    const newNetAddr = document.getElementById('newNetAddr');
    const addNetwork = document.getElementById('addNetwork');
    const saveWallets = document.getElementById('saveWallets');
    const walletsMsg = document.getElementById('walletsMsg');

    // Online wallets rates
    const owList = document.getElementById('owList');
    const owName = document.getElementById('owName');
    const owCurrency = document.getElementById('owCurrency');
    const owRate = document.getElementById('owRate');
    const addOW = document.getElementById('addOW');

    let usdtNetworks = []; // {network,address}
    let onlineWallets = []; // {name, currency, rate, enabled}

    // Giftcards
    const gcId = document.getElementById('gcId');
    const gcName = document.getElementById('gcName');
    const gcLogo = document.getElementById('gcLogo');
    const gcCountries = document.getElementById('gcCountries');
    const newCtry = document.getElementById('newCtry');
    const newRate = document.getElementById('newRate');
    const newMin  = document.getElementById('newMin');
    const addCtry = document.getElementById('addCtry');
    const saveGiftcardBtn = document.getElementById('saveGiftcard');
    const loadGiftcardBtn = document.getElementById('loadGiftcard');
    const deleteGiftcardBtn = document.getElementById('deleteGiftcard');
    const gcMsg = document.getElementById('gcMsg');
    let gcCountryRates = []; // [{code,name,rate,min}]

    // Announcements
    const annTextarea = document.getElementById('annTextarea');
    const saveAnn = document.getElementById('saveAnn');
    const annMsg = document.getElementById('annMsg');

    // Proof upload
    const proofReqId = document.getElementById('proofReqId');
    const proofFile = document.getElementById('proofFile');
    const uploadProof = document.getElementById('uploadProof');
    const proofMsg = document.getElementById('proofMsg');

    // ----- helpers -----
    const countryName = (code)=>{
      const map = {US:'United States',UK:'United Kingdom',EU:'Eurozone',CA:'Canada',AU:'Australia',CH:'Switzerland',NG:'Nigeria'};
      return map[code] || code;
    };

    function renderNetworks(){
      networksList.innerHTML='';
      if(!usdtNetworks.length){networksList.innerHTML='<div class="muted">No USDT networks yet.</div>';return;}
      usdtNetworks.forEach((n,i)=>{
        const row=document.createElement('div');
        row.className='flex';
        row.style.justifyContent='space-between'; row.style.padding='6px 0';
        row.innerHTML=`<div class="flex"><span class="pill">${n.network}</span><span class="muted" style="margin-left:6px">${n.address}</span></div><button data-i="${i}" class="btn-ghost">Remove</button>`;
        row.querySelector('button').onclick=()=>{usdtNetworks.splice(i,1);renderNetworks();};
        networksList.appendChild(row);
      });
    }

    function renderOW(){
      owList.innerHTML='';
      if(!onlineWallets.length){owList.innerHTML='<div class="muted">No wallets yet. Add some (Chime, PayPal, Venmo, Zelle, Cash App, Skrill, Wise…)</div>';return;}
      const tbl=document.createElement('table');
      tbl.innerHTML=`<thead><tr><th>Wallet</th><th>Currency</th><th>Rate (₦/unit)</th><th>Status</th><th>Actions</th></tr></thead>`;
      const tb=document.createElement('tbody');
      onlineWallets.forEach((w,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${w.name}</td><td>${w.currency}</td><td>${w.rate}</td><td>${w.enabled?'Enabled':'Disabled'}</td>
          <td class="flex">
            <button data-i="${i}" class="btn-ghost">${w.enabled?'Disable':'Enable'}</button>
            <button data-del="${i}" class="btn-ghost" style="background:#fee2e2">Remove</button>
          </td>`;
        tr.querySelector('[data-i]').onclick=()=>{onlineWallets[i].enabled=!onlineWallets[i].enabled;renderOW();};
        tr.querySelector('[data-del]').onclick=()=>{onlineWallets.splice(i,1);renderOW();};
        tb.appendChild(tr);
      });
      tbl.appendChild(tb); owList.appendChild(tbl);
    }

    addOW.onclick=()=>{
      const name=(owName.value||'').trim(); const cur=owCurrency.value; const rate=Number(owRate.value||0);
      if(!name || !rate) return;
      const idx=onlineWallets.findIndex(x=>x.name.toLowerCase()===name.toLowerCase());
      const row={name,currency:cur,rate,enabled:true};
      if(idx>=0) onlineWallets[idx]=row; else onlineWallets.push(row);
      owName.value=''; owRate.value=''; renderOW();
    };

    addNetwork.onclick=()=>{ const n=(newNetName.value||'').trim(), a=(newNetAddr.value||'').trim(); if(!n||!a) return; usdtNetworks.push({network:n,address:a}); newNetName.value=''; newNetAddr.value=''; renderNetworks(); };

    function renderGcCountries(){
      gcCountries.innerHTML='';
      if(!gcCountryRates.length){gcCountries.innerHTML='<div class="muted">No countries yet.</div>';return;}
      const tbl=document.createElement('table');
      tbl.innerHTML=`<thead><tr><th>Country</th><th>Rate (₦/unit)</th><th>Min</th><th>Actions</th></tr></thead>`;
      const tb=document.createElement('tbody');
      gcCountryRates.forEach((c,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${c.name} (${c.code})</td><td>${c.rate}</td><td>${c.min||'-'}</td>
        <td><button data-i="${i}" class="btn-ghost" style="background:#fee2e2">Remove</button></td>`;
        tr.querySelector('button').onclick=()=>{gcCountryRates.splice(i,1);renderGcCountries();};
        tb.appendChild(tr);
      });
      tbl.appendChild(tb); gcCountries.appendChild(tbl);
    }

    addCtry.onclick=()=>{
      const code=newCtry.value; const rate=Number(newRate.value||0); const min=Number(newMin.value||0);
      if(!code || !rate) return;
      const i=gcCountryRates.findIndex(x=>x.code===code);
      const row={code,name:countryName(code),rate,min:min||0};
      if(i>=0) gcCountryRates[i]=row; else gcCountryRates.push(row);
      newRate.value=''; newMin.value=''; renderGcCountries();
    };

    // ----- Auth -----
    loginBtn.onclick = async ()=>{
      authMsg.textContent='Signing in...';
      try{ await signInWithEmailAndPassword(emailEl.value.trim(), passEl.value); authMsg.textContent=''; }
      catch(e){ authMsg.textContent='Sign in failed: '+(e.message||e.code); }
    };
    resetBtn.onclick = async ()=>{
      const em=(emailEl.value||'').trim(); if(!em){authMsg.textContent='Enter email first.';return;}
      try{ await sendPasswordResetEmail(em); authMsg.textContent='Reset link sent to '+em; }catch(e){ authMsg.textContent='Reset failed: '+(e.message||e.code); }
    };
    logoutBtn.onclick = async ()=>{ await signOut(); location.reload(); };

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ authBlock.classList.remove('hidden'); adminPanel.classList.add('hidden'); notAdmin.classList.add('hidden'); return; }
      const a=await getDoc(doc(db,'admins',user.email));
      if(!a.exists()){ authBlock.classList.add('hidden'); notAdmin.classList.remove('hidden'); adminPanel.classList.add('hidden'); return; }
      authBlock.classList.add('hidden'); notAdmin.classList.add('hidden'); adminPanel.classList.remove('hidden');
      await loadRates(); await loadWallets(); await preloadIfEmpty(); await loadAnnouncements();
    });

    // ----- Loads & Saves -----
    async function loadRates(){
      try{ const r=await getDoc(doc(db,'rates','default')); if(r.exists()){const d=r.data(); usdToNgn.value=d.usdToNgn??''; giftcardBase.value=d.giftcardBase??'';} }catch(e){console.warn(e);}
    }
    saveRates.onclick = async ()=>{
      ratesMsg.textContent='Saving...';
      try{
        await setDoc(doc(db,'rates','default'),{usdToNgn:Number(usdToNgn.value||0),giftcardBase:Number(giftcardBase.value||0)},{merge:true});
        ratesMsg.textContent='Saved ✓'; setTimeout(()=>ratesMsg.textContent='',1200);
      }catch(e){ratesMsg.textContent='Error: '+(e.message||e.code);}
    };

    async function loadWallets(){
      try{
        const w=await getDoc(doc(db,'wallets','default'));
        if(w.exists()){
          const d=w.data();
          btcAddress.value=d?.btc?.address||'';
          const tags=d?.tags||{}; tagChime.value=tags.chime||''; tagZelle.value=tags.zelle||''; tagVenmo.value=tags.venmo||''; tagPaypal.value=tags.paypal||'';
          usdtNetworks=(d?.usdt?.networks||[]).slice(); renderNetworks();
          onlineWallets=(d?.onlineWallets||[]).slice(); renderOW();
        }else{ usdtNetworks=[]; renderNetworks(); onlineWallets=[]; renderOW(); }
      }catch(e){console.warn(e);}
    }
    saveWallets.onclick = async ()=>{
      walletsMsg.textContent='Saving...';
      try{
        const payload={
          btc:{address:(btcAddress.value||'').trim()},
          usdt:{networks:usdtNetworks},
          onlineWallets,
          tags:{ chime:(tagChime.value||'').trim(), zelle:(tagZelle.value||'').trim(), venmo:(tagVenmo.value||'').trim(), paypal:(tagPaypal.value||'').trim() }
        };
        await setDoc(doc(db,'wallets','default'),payload,{merge:true});
        walletsMsg.textContent='Saved ✓'; setTimeout(()=>walletsMsg.textContent='',1200);
      }catch(e){walletsMsg.textContent='Error: '+(e.message||e.code);}
    };

    // Giftcards
    saveGiftcardBtn.onclick = async ()=>{
      gcMsg.textContent='Saving...';
      try{
        const id=(gcId.value||'').trim(); if(!id){gcMsg.textContent='Enter ID.';return;}
        const payload={ name:(gcName.value||'').trim(), countries:gcCountryRates };
        const file=gcLogo.files?.[0]||null;
        await saveGiftcard(id,payload,file);
        gcMsg.textContent='Saved ✓'; setTimeout(()=>gcMsg.textContent='',1200);
      }catch(e){gcMsg.textContent='Error: '+(e.message||e.code);}
    };
    loadGiftcardBtn.onclick = async ()=>{
      gcMsg.textContent='Loading...';
      const id=(gcId.value||'').trim(); if(!id){gcMsg.textContent='Enter ID.';return;}
      try{
        const d=await getGiftcard(id);
        if(!d){gcMsg.textContent='Not found';return;}
        gcName.value=d.name||id;
        gcCountryRates=(d.countries||[]).slice(); renderGcCountries();
        gcMsg.textContent='Loaded ✓'; setTimeout(()=>gcMsg.textContent='',1200);
      }catch(e){gcMsg.textContent='Error: '+(e.message||e.code);}
    };
    deleteGiftcardBtn.onclick = async ()=>{
      const id=(gcId.value||'').trim(); if(!id) return;
      if(!confirm('Delete gift card brand '+id+'?')) return;
      await deleteDoc(doc(db,'giftcards',id));
      gcName.value=''; gcCountryRates=[]; renderGcCountries(); gcMsg.textContent='Deleted ✓'; setTimeout(()=>gcMsg.textContent='',1200);
    };

    // Announcements
    async function loadAnnouncements(){
      try{ const a=await getDoc(doc(db,'announcements','default')); if(a.exists()){ const d=a.data(); annTextarea.value=(Array.isArray(d.items)?d.items:[]).join('\n'); } }catch(e){console.warn(e);}
    }
    saveAnn.onclick = async ()=>{
      annMsg.textContent='Saving...';
      try{
        const items=(annTextarea.value||'').split('\n').map(s=>s.trim()).filter(Boolean);
        await setDoc(doc(db,'announcements','default'),{items},{merge:true});
        annMsg.textContent='Saved ✓'; setTimeout(()=>annMsg.textContent='',1200);
      }catch(e){annMsg.textContent='Error: '+(e.message||e.code);}
    };

    // Upload proof to a request
    uploadProof.onclick = async ()=>{
      proofMsg.textContent='Uploading...';
      try{
        const rid=(proofReqId.value||'').trim(); const file=proofFile.files?.[0]; if(!rid||!file){proofMsg.textContent='Enter requestId and choose an image.';return;}
        const r=storageRef(storage,`requests/${rid}/admin-proof-${Date.now()}`);
        await uploadBytes(r,file); const url=await getDownloadURL(r);
        await setDoc(doc(db,'requests',rid),{adminProofUrl:url},{merge:true});
        proofMsg.textContent='Uploaded ✓'; setTimeout(()=>proofMsg.textContent='',1400);
      }catch(e){proofMsg.textContent='Error: '+(e.message||e.code);}
    };

    // Preload some brands if empty (one-time helper)
    async function preloadIfEmpty(){
      const snap=await getDocs(collection(db,'giftcards'));
      if(!snap.empty) return;
      const presets=[
        {id:'amazon', name:'Amazon'},
        {id:'itunes', name:'Apple / iTunes'},
        {id:'steam', name:'Steam'},
        {id:'googleplay', name:'Google Play'},
        {id:'razergold', name:'Razer Gold'},
        {id:'walmart', name:'Walmart'},
        {id:'visa', name:'Visa Vanilla'},
        {id:'amex', name:'American Express'},
        {id:'xbox', name:'Xbox'}
      ];
      for(const p of presets){
        await setDoc(doc(db,'giftcards',p.id),{
          name:p.name,
          countries:[
            {code:'US',name:'United States',rate:1500,min:5},
            {code:'UK',name:'United Kingdom',rate:1900,min:5},
            {code:'EU',name:'Eurozone',rate:1600,min:5}
          ]
        },{merge:true});
      }
      // Preload some online wallets list too (if none)
      const w=await getDoc(doc(db,'wallets','default'));
      if(!w.exists() || !(w.data().onlineWallets||[]).length){
        await setDoc(doc(db,'wallets','default'),{
          onlineWallets:[
            {name:'Chime', currency:'USD', rate:1500, enabled:true},
            {name:'PayPal', currency:'USD', rate:1450, enabled:true},
            {name:'Zelle', currency:'USD', rate:1500, enabled:true},
            {name:'Venmo', currency:'USD', rate:1480, enabled:true},
            {name:'Cash App', currency:'USD', rate:1490, enabled:true}
          ]
        },{merge:true});
      }
    }
  </script>
</body>
</html>
