<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Toolspay</title>
</head>
<body>
  <h1>Welcome to Toolspay</h1>
  <section class="payment-methods">
  <h2>Set Your Payment Method</h2>
  <form id="paymentForm">
    <label for="method">Payment Method:</label>
    <select id="method" name="method" required>
      <option value="">-- Select Payment Method --</option>
      <option value="Bank">Bank Transfer</option>
      <option value="BTC">Bitcoin (BTC)</option>
      <option value="USDT">Tether (USDT)</option>
      <option value="OnlineWallet">Online Digital Wallet</option>
    </select>

    <div id="extraFields"></div>

    <button type="submit">Save Payment Method</button>
  </form>

  <p id="paymentStatus"></p>
  </section>
  <button id="logoutBtn">Logout</button>

  <h2>Payment Method Setup</h2>
  <form id="paymentForm">
    <label>Select Payment Method:</label>
    <select id="paymentMethod" required>
      <option value="">--Select--</option>
      <option value="bank">Bank Transfer</option>
      <option value="btc">Bitcoin (BTC)</option>
      <option value="usdt">USDT</option>
      <option value="wallet">Online Digital Wallet</option>
    </select>

    <div id="bankFields" style="display:none;">
      <label>Bank Name:</label>
      <input type="text" id="bankName">
      <label>Account Number:</label>
      <input type="text" id="accountNumber">
      <label>Account Holder:</label>
      <input type="text" id="accountHolder">
    </div>

    <div id="cryptoFields" style="display:none;">
      <label>Wallet Address:</label>
      <input type="text" id="walletAddress">
      <label>Chain Type (e.g., ERC20, TRC20):</label>
      <input type="text" id="chainType">
    </div>

    <div id="onlineWalletFields" style="display:none;">
      <label>Wallet Email or ID:</label>
      <input type="text" id="walletEmail">
    </div>

    <button type="submit">Save Payment Method</button>
  </form>

  <p id="statusMsg"></p>

  <script type="module">import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { app } from "./firebase-config.js";

const auth = getAuth(app);
const db = getFirestore(app);

const methodSelect = document.getElementById("method");
const extraFields = document.getElementById("extraFields");
const paymentForm = document.getElementById("paymentForm");
const paymentStatus = document.getElementById("paymentStatus");

methodSelect.addEventListener("change", () => {
  const method = methodSelect.value;
  extraFields.innerHTML = "";

  if (method === "Bank") {
    extraFields.innerHTML = `
      <label>Bank Name:</label><input type="text" id="bankName" required>
      <label>Account Name:</label><input type="text" id="accountName" required>
      <label>Account Number:</label><input type="text" id="accountNumber" required>
    `;
  } 
  else if (method === "BTC") {
    extraFields.innerHTML = `
      <label>BTC Wallet Address:</label><input type="text" id="btcAddress" required>
    `;
  } 
  else if (method === "USDT") {
    extraFields.innerHTML = `
      <label>Chain Type:</label>
      <select id="chainType" required>
        <option value="">-- Select Chain --</option>
        <option value="TRC20">TRC20</option>
        <option value="ERC20">ERC20</option>
        <option value="BEP20">BEP20</option>
      </select>
      <label>USDT Wallet Address:</label><input type="text" id="usdtAddress" required>
    `;
  }
  else if (method === "OnlineWallet") {
    extraFields.innerHTML = `
      <label>Wallet Name:</label><input type="text" id="walletName" required>
      <label>Wallet Tag:</label><input type="text" id="walletTag" required>
    `;
  }
});

paymentForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const user = auth.currentUser;
  if (!user) return;

  const method = methodSelect.value;
  let paymentData = { method };

  if (method === "Bank") {
    paymentData.bankName = document.getElementById("bankName").value;
    paymentData.accountName = document.getElementById("accountName").value;
    paymentData.accountNumber = document.getElementById("accountNumber").value;
  }
  else if (method === "BTC") {
    paymentData.btcAddress = document.getElementById("btcAddress").value;
  }
  else if (method === "USDT") {
    paymentData.chainType = document.getElementById("chainType").value;
    paymentData.usdtAddress = document.getElementById("usdtAddress").value;
  }
  else if (method === "OnlineWallet") {
    paymentData.walletName = document.getElementById("walletName").value;
    paymentData.walletTag = document.getElementById("walletTag").value;
  }

  try {
    await setDoc(doc(db, "paymentMethods", user.uid), paymentData);
    paymentStatus.textContent = "✅ Payment method saved successfully!";
    paymentStatus.style.color = "green";
  } catch (error) {
    paymentStatus.textContent = "❌ Error saving payment method.";
    paymentStatus.style.color = "red";
  }
});

onAuthStateChanged(auth, async (user) => {
  if (user) {
    const docSnap = await getDoc(doc(db, "paymentMethods", user.uid));
    if (docSnap.exists()) {
      methodSelect.value = docSnap.data().method;
    }
  }
});
    import { 
      auth, signOut, onAuthStateChanged, db, 
      doc, setDoc, getDoc 
    } from './firebase-auth.js';

    const logoutBtn = document.getElementById('logoutBtn');
    logoutBtn.addEventListener('click', () => signOut(auth));

    const paymentMethodSelect = document.getElementById('paymentMethod');
    const bankFields = document.getElementById('bankFields');
    const cryptoFields = document.getElementById('cryptoFields');
    const onlineWalletFields = document.getElementById('onlineWalletFields');
    const paymentForm = document.getElementById('paymentForm');
    const statusMsg = document.getElementById('statusMsg');

    function showFields(method) {
      bankFields.style.display = method === 'bank' ? 'block' : 'none';
      cryptoFields.style.display = (method === 'btc' || method === 'usdt') ? 'block' : 'none';
      onlineWalletFields.style.display = method === 'wallet' ? 'block' : 'none';
    }

    paymentMethodSelect.addEventListener('change', (e) => {
      showFields(e.target.value);
    });

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'login.html';
      } else {
        // Load saved payment details
        const docRef = doc(db, 'paymentMethods', user.uid);
        const snap = await getDoc(docRef);
        if (snap.exists()) {
          const data = snap.data();
          paymentMethodSelect.value = data.method || '';
          showFields(data.method || '');
          document.getElementById('bankName').value = data.bankName || '';
          document.getElementById('accountNumber').value = data.accountNumber || '';
          document.getElementById('accountHolder').value = data.accountHolder || '';
          document.getElementById('walletAddress').value = data.walletAddress || '';
          document.getElementById('chainType').value = data.chainType || '';
          document.getElementById('walletEmail').value = data.walletEmail || '';
        }
      }
    });

    paymentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return;

      const data = {
        method: paymentMethodSelect.value,
        bankName: document.getElementById('bankName').value,
        accountNumber: document.getElementById('accountNumber').value,
        accountHolder: document.getElementById('accountHolder').value,
        walletAddress: document.getElementById('walletAddress').value,
        chainType: document.getElementById('chainType').value,
        walletEmail: document.getElementById('walletEmail').value
      };

      await setDoc(doc(db, 'paymentMethods', user.uid), data, { merge: true });
      statusMsg.textContent = 'Payment method saved successfully!';
      statusMsg.style.color = 'green';
    });
  </script>
</body>
</html>
